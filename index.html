<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poker Game è¨˜å¸³æ¿</title>
    <style>
        :root {
            /* ç¾ä»£æ·±è‰²ç°¡ç´„ä¸»é¡Œ */
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            
            --green: #4cd137;  /* è´éŒ¢ / å¹³è¡¡ */
            --red: #e84118;    /* è¼¸éŒ¢ / éŒ¯èª¤ */
            --blue: #00a8ff;   /* é‡é» */
            --grey: #555555;   /* é‡ç½® */
            --orange: #e67e22; /* ä¸Šä¸€æ­¥/ä¸‹ä¸€æ­¥ */
            
            --border-radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 15px;
            padding-bottom: 120px; /* é ç•™åº•éƒ¨å›ºå®šæ¬„ç©ºé–“ */
            -webkit-font-smoothing: antialiased;
        }

        /* æ¨™é¡Œèˆ‡æŒ‰éˆ•å€ (Header) - ä¿®æ”¹ç‚ºç½®ä¸­ä½ˆå±€ */
        .header {
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            justify-content: center;
            align-items: center;    /* æ°´å¹³ç½®ä¸­ */
            margin-bottom: 25px;    /* å¢åŠ ä¸‹æ–¹é–“è· */
            gap: 15px;              /* æ¨™é¡Œèˆ‡æŒ‰éˆ•çš„é–“è· */
        }
        
        .header-info {
            text-align: center;     /* æ–‡å­—ç½®ä¸­ */
        }
        
        .header-info h1 { 
            margin: 0; 
            font-size: 1.5rem;      /* ç¨å¾®åŠ å¤§æ¨™é¡Œ */
            color: var(--text-main); 
            margin-bottom: 5px;     /* æ¨™é¡Œèˆ‡äººæ•¸çš„é–“è· */
        }
        
        .player-count { color: var(--text-sub); font-size: 0.9rem; }

        /* æŒ‰éˆ•ç¾¤çµ„ - ä¿®æ”¹ç‚ºç½®ä¸­ */
        .header-actions {
            display: flex;
            gap: 6px;               /* æŒ‰éˆ•é–“è· */
            flex-wrap: wrap;        /* å…è¨±æ›è¡Œï¼Œé˜²æ­¢å°è¢å¹•çˆ†ç‰ˆ */
            justify-content: center;/* æŒ‰éˆ•ç½®ä¸­ */
            width: 100%;
        }

        /* é€šç”¨æ¨™é ­æŒ‰éˆ•æ¨£å¼ */
        .btn-header {
            border: none;
            padding: 6px 10px;      /* ç¸®å°ç´„ 20% (åŸ 8px 12px) */
            border-radius: 16px;    /* ç¨å¾®èª¿æ•´åœ“è§’æ¯”ä¾‹ */
            font-size: 0.75rem;     /* ç¸®å°å­—é«” (åŸ 0.85rem) */
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 3px;               /* ç¸®å°é–“è· (åŸ 4px) */
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            white-space: nowrap;
        }
        .btn-header:active { transform: scale(0.95); }

        .btn-add { background-color: var(--green); color: white; }
        .btn-export { background-color: var(--blue); color: white; }
        .btn-reset { background-color: var(--grey); color: #ddd; }
        .btn-undo { background-color: var(--orange); color: white; } 
        .btn-redo { background-color: var(--orange); color: white; }

        /* ç©å®¶å¡ç‰‡åˆ—è¡¨ */
        .player-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .player-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr; /* å·¦å³å…©æ¬„ */
            gap: 15px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* å¡ç‰‡ç¬¬ä¸€è¡Œï¼šåå­—èˆ‡åˆªé™¤ */
        .card-header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 5px;
        }
        .p-name { font-size: 1.2rem; font-weight: bold; }
        .p-result { font-size: 1.2rem; font-weight: bold; }
        
        .btn-del {
            background: transparent;
            border: none;
            color: #555;
            font-size: 1.2rem;
            padding: 5px;
            cursor: pointer;
        }
        .btn-del:hover { color: var(--red); }

        /* è¼¸å…¥å€å¡Š */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .label { font-size: 0.8rem; color: var(--text-sub); }
        
        input[type="number"] {
            background-color: var(--input-bg);
            border: 1px solid #444;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            outline: none;
        }
        input:focus { border-color: var(--blue); background-color: #333; }
        
        /* é‡å° Cash Out ç‰¹åˆ¥æ¨£å¼ */
        .input-cashout input {
            border-color: #004e75;
            background-color: #0a1820;
        }
        .input-cashout input:focus { border-color: var(--blue); }

        /* é¡è‰² helper */
        .win { color: var(--green); }
        .lose { color: var(--red); }

        /* åº•éƒ¨å›ºå®šçµ±è¨ˆåˆ— */
        .footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #252525;
            border-top: 1px solid #333;
            padding: 15px;
            box-sizing: border-box;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .footer-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-sub);
        }
        .footer-stats strong { color: white; font-size: 1.1rem; }
        
        .footer-status {
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            padding-top: 5px;
            border-top: 1px dashed #444;
        }

        /* å½ˆå‡ºè¦–çª— (Modal) */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal {
            background: #252525;
            padding: 25px;
            border-radius: 16px;
            width: 85%;
            max-width: 320px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }
        .modal h2 { margin-top: 0; font-size: 1.2rem; margin-bottom: 20px; }
        
        .modal-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #111;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            text-align: center;
            box-sizing: border-box;
        }
        
        .modal-textarea {
            width: 100%;
            height: 200px;
            background: #111;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-family: monospace;
            padding: 10px;
            box-sizing: border-box;
            margin-bottom: 15px;
            resize: none;
            line-height: 1.5;
        }

        .modal-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-modal {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }
        .btn-cancel { background: #444; color: #ccc; }
        .btn-confirm { background: var(--green); color: white; }
        .btn-confirm-red { background: var(--red); color: white; }
        .btn-copy { background: var(--blue); color: white; grid-column: 1 / -1; }

        /* ç©ºç‹€æ…‹æç¤º */
        .empty-state {
            text-align: center;
            color: #444;
            margin-top: 50px;
            font-style: italic;
        }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨å€ -->
    <div class="header">
        <div class="header-info">
            <h1>è”æè§’é‚ªæƒ¡æ¦œ</h1>
            <span class="player-count">äººæ•¸: <span id="playerCount">0</span></span>
        </div>
        <div class="header-actions">
            <!-- æ­·å²æ“ä½œå€ -->
            <button class="btn-header btn-undo" onclick="executeUndo()">
                <span>â†©ï¸</span> ä¸Šä¸€æ­¥
            </button>
            <button class="btn-header btn-redo" onclick="executeRedo()">
                <span>â†ªï¸</span> ä¸‹ä¸€æ­¥
            </button>

            <!-- åŠŸèƒ½æ“ä½œå€ -->
            <button class="btn-header btn-reset" onclick="openResetModal()">
                <span>ğŸ”„</span> é‡ç½®
            </button>
            <button class="btn-header btn-export" onclick="openExportModal()">
                <span>ğŸ“‹</span> åŒ¯å‡º
            </button>
            <button class="btn-header btn-add" onclick="openAddModal()">
                <span>ï¼‹</span> æ–°å¢
            </button>
        </div>
    </div>

    <!-- ç©å®¶å¡ç‰‡åˆ—è¡¨ -->
    <div id="playerList" class="player-list">
        <!-- å¡ç‰‡æœƒå‹•æ…‹æ’å…¥é€™è£¡ -->
        <div class="empty-state">å°šæœªåŠ å…¥ç©å®¶<br>é»æ“Šå³ä¸Šè§’æ–°å¢</div>
    </div>

    <!-- åº•éƒ¨å›ºå®šçµ±è¨ˆ -->
    <div class="footer-bar">
        <div class="footer-stats">
            <div>ç¸½è²·å…¥: <strong id="totalBuyIn">0</strong></div>
            <div>ç¸½çµç®—: <strong id="totalCashOut">0</strong></div>
        </div>
        <div id="balanceStatus" class="footer-status">
            æº–å‚™é–‹å§‹
        </div>
    </div>

    <!-- 1. æ–°å¢ç©å®¶å½ˆçª— -->
    <div id="addPlayerModal" class="modal-overlay" onclick="closeAddModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>æ–°å¢ç©å®¶</h2>
            <input type="text" id="modalName" class="modal-input" placeholder="åå­— (ä¾‹å¦‚: Ryan)" autocomplete="off">
            <input type="number" id="modalBuyIn" class="modal-input" placeholder="è²·å…¥é‡‘é¡" inputmode="numeric">
            <div class="modal-btns">
                <button class="btn-modal btn-cancel" onclick="closeAddModal()">å–æ¶ˆ</button>
                <button class="btn-modal btn-confirm" onclick="confirmAddPlayer()">ç¢ºèª</button>
            </div>
        </div>
    </div>

    <!-- 2. ä¿®æ”¹ç¢ºèªå½ˆçª— -->
    <div id="changeConfirmModal" class="modal-overlay">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>âš ï¸ ç¢ºèªä¿®æ”¹</h2>
            <p id="changeConfirmMessage" style="color:#ccc; margin-bottom:20px; line-height:1.5;">å…§å®¹...</p>
            <div class="modal-btns">
                <button class="btn-modal btn-cancel" onclick="cancelChange()">å–æ¶ˆ</button>
                <button class="btn-modal btn-confirm" onclick="executeChange()">ç¢ºèªä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <!-- 3. åˆªé™¤ç¢ºèªå½ˆçª— -->
    <div id="deleteModal" class="modal-overlay" onclick="closeDeleteModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 style="color: var(--red);">ç§»é™¤ç©å®¶</h2>
            <p id="deleteMessage" style="color:#ccc; margin-bottom:20px;">ç¢ºå®šè¦ç§»é™¤å—ï¼Ÿ</p>
            <div class="modal-btns">
                <button class="btn-modal btn-cancel" onclick="closeDeleteModal()">å–æ¶ˆ</button>
                <button class="btn-modal btn-confirm-red" onclick="executeDelete()">ç§»é™¤</button>
            </div>
        </div>
    </div>

    <!-- 4. åŒ¯å‡ºçµæœå½ˆçª— -->
    <div id="exportModal" class="modal-overlay" onclick="closeExportModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>æˆ°ç¸¾åŒ¯å‡º</h2>
            <textarea id="exportText" class="modal-textarea" readonly></textarea>
            <div class="modal-btns">
                <button class="btn-modal btn-cancel" onclick="closeExportModal()">é—œé–‰</button>
                <button class="btn-modal btn-copy" onclick="copyToClipboard()">è¤‡è£½æ–‡å­—</button>
            </div>
        </div>
    </div>

    <!-- 5. é‡ç½®ç¢ºèªå½ˆçª— -->
    <div id="resetModal" class="modal-overlay" onclick="closeResetModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 style="color: var(--red);">âš ï¸ é‡ç½®éŠæˆ²</h2>
            <p style="color:#ccc; margin-bottom:20px;">ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™é‡æ–°é–‹å§‹å—ï¼Ÿ<br>(æ­¤å‹•ä½œç„¡æ³•å¾©åŸ)</p>
            <div class="modal-btns">
                <button class="btn-modal btn-cancel" onclick="closeResetModal()">å–æ¶ˆ</button>
                <button class="btn-modal btn-confirm-red" onclick="executeReset()">ç¢ºå®šé‡ç½®</button>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let historyStack = []; // æ­·å²ç´€éŒ„å †ç–Š
        let redoStack = [];    // é‡åšç´€éŒ„å †ç–Š (ä¸‹ä¸€æ­¥)
        const DEFAULT_BUYIN = 1000;
        
        // æš«å­˜è®Šæ•¸
        let pendingChange = null;
        let playerToDeleteId = null;

        // --- å„²å­˜èˆ‡è®€å– (Local Storage) ---
        function saveToStorage() {
            localStorage.setItem('poker_players_v2', JSON.stringify(players));
        }

        function loadFromStorage() {
            const data = localStorage.getItem('poker_players_v2');
            if (data) {
                try {
                    players = JSON.parse(data);
                    renderPlayerList();
                } catch(e) {
                    console.error("Save data corrupted", e);
                }
            }
        }

        // --- æ­·å²ç´€éŒ„åŠŸèƒ½ (ä¸Šä¸€æ­¥/ä¸‹ä¸€æ­¥) ---
        function recordHistory() {
            // æ·±å±¤è¤‡è£½ç•¶å‰ç‹€æ…‹ä¸¦æ¨å…¥æ­·å²å †ç–Š
            historyStack.push(JSON.parse(JSON.stringify(players)));
            // é™åˆ¶ç´€éŒ„æ­¥æ•¸ï¼Œé¿å…è¨˜æ†¶é«”éå¤§ (ä¾‹å¦‚ä¿ç•™æœ€è¿‘50æ­¥)
            if (historyStack.length > 50) historyStack.shift();
            
            // ä¸€æ—¦æœ‰æ–°æ“ä½œï¼Œæ¸…ç©º Redo å †ç–Š
            redoStack = [];
        }

        function executeUndo() {
            if (historyStack.length === 0) {
                alert("æ²’æœ‰ä¸Šä¸€æ­¥ç´€éŒ„");
                return;
            }
            
            // åœ¨é‚„åŸä¹‹å‰ï¼Œå°‡ç•¶å‰ç‹€æ…‹å­˜å…¥ Redo å †ç–Š
            redoStack.push(JSON.parse(JSON.stringify(players)));
            
            // æ¢å¾©ä¸Šä¸€å€‹ç‹€æ…‹
            players = historyStack.pop();
            saveToStorage();
            renderPlayerList();
        }

        function executeRedo() {
            if (redoStack.length === 0) {
                alert("æ²’æœ‰ä¸‹ä¸€æ­¥ç´€éŒ„");
                return;
            }

            // åœ¨é‡åšä¹‹å‰ï¼Œå°‡ç•¶å‰ç‹€æ…‹å­˜å…¥ History å †ç–Š (é€™æ¨£æ‰èƒ½å†æ¬¡ Undo)
            historyStack.push(JSON.parse(JSON.stringify(players)));

            // æ¢å¾©ä¸‹ä¸€å€‹ç‹€æ…‹
            players = redoStack.pop();
            saveToStorage();
            renderPlayerList();
        }

        // --- 1. æ–°å¢ç©å®¶ ---
        function openAddModal() {
            document.getElementById('addPlayerModal').style.display = 'flex';
            document.getElementById('modalName').focus();
            const lastBuyIn = players.length > 0 ? players[players.length-1].buyIn : DEFAULT_BUYIN;
            document.getElementById('modalBuyIn').value = lastBuyIn;
        }

        function closeAddModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('addPlayerModal').style.display = 'none';
        }

        function confirmAddPlayer() {
            const name = document.getElementById('modalName').value.trim();
            const buyIn = parseFloat(document.getElementById('modalBuyIn').value);

            if (!name || isNaN(buyIn)) {
                alert("è«‹è¼¸å…¥å®Œæ•´çš„åå­—å’Œé‡‘é¡");
                return;
            }

            // ç´€éŒ„æ­·å²
            recordHistory();

            players.push({
                id: Date.now(),
                name: name,
                buyIn: buyIn,
                cashOut: 0
            });

            saveToStorage();
            document.getElementById('modalName').value = '';
            closeAddModal();
            renderPlayerList();
        }

        // --- 2. æ•¸å€¼ä¿®æ”¹ (è‡ªå‹•è¨ˆç®— + ç¢ºèª) ---
        function requestUpdate(id, type, inputElement) {
            const newValue = parseFloat(inputElement.value);
            const player = players.find(p => p.id === id);
            
            if (!player) return;
            if (isNaN(newValue)) {
                renderPlayerList(); // é‚„åŸ
                return;
            }
            
            const oldValue = type === 'buyIn' ? player.buyIn : player.cashOut;
            if (newValue === oldValue) return; // æ²’è®Š

            pendingChange = { id, type, newValue, player };
            
            const fieldName = type === 'buyIn' ? 'ç¸½è²·å…¥' : 'ç¸½çµç®—';
            const color = type === 'buyIn' ? '#fff' : '#00a8ff';
            const msg = `ä¿®æ”¹ <strong>${player.name}</strong> çš„ ${fieldName}?<br><br>
                         ${oldValue} â <span style="color:${color}; font-weight:bold; font-size:1.2rem">${newValue}</span>`;
            
            document.getElementById('changeConfirmMessage').innerHTML = msg;
            document.getElementById('changeConfirmModal').style.display = 'flex';
        }

        function executeChange() {
            if (pendingChange) {
                // ç´€éŒ„æ­·å² (åœ¨ä¿®æ”¹å‰)
                recordHistory();

                const { player, type, newValue } = pendingChange;
                if (type === 'buyIn') player.buyIn = newValue;
                else player.cashOut = newValue;
                
                saveToStorage();
                renderPlayerList();
            }
            document.getElementById('changeConfirmModal').style.display = 'none';
            pendingChange = null;
        }

        function cancelChange() {
            renderPlayerList(); // åªæ˜¯é‡ç¹ªé‚„åŸæ•¸å€¼
            document.getElementById('changeConfirmModal').style.display = 'none';
            pendingChange = null;
        }

        // --- 3. åˆªé™¤é‚è¼¯ ---
        function openDeleteModal(id) {
            const player = players.find(p => p.id === id);
            if (!player) return;
            playerToDeleteId = id;
            document.getElementById('deleteMessage').innerHTML = `ç¢ºå®šç§»é™¤ <strong>${player.name}</strong> å—ï¼Ÿ`;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function closeDeleteModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('deleteModal').style.display = 'none';
            playerToDeleteId = null;
        }

        function executeDelete() {
            if (playerToDeleteId !== null) {
                // ç´€éŒ„æ­·å²
                recordHistory();

                players = players.filter(p => p.id !== playerToDeleteId);
                saveToStorage();
                renderPlayerList();
            }
            document.getElementById('deleteModal').style.display = 'none';
        }

        // --- 4. åŒ¯å‡ºæˆ°ç¸¾é‚è¼¯ ---
        function openExportModal() {
            if (players.length === 0) {
                alert("ç›®å‰æ²’æœ‰ç©å®¶è³‡æ–™");
                return;
            }

            const now = new Date();
            const dateStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')}`;

            let winners = [];
            let losers = [];
            
            players.forEach(p => {
                const result = p.cashOut - p.buyIn;
                if (result > 0) {
                    winners.push({ name: p.name, result: result });
                } else if (result < 0) {
                    losers.push({ name: p.name, result: result });
                }
            });

            winners.sort((a, b) => b.result - a.result);
            losers.sort((a, b) => a.result - b.result);

            let text = `${dateStr}\n`;
            text += `\nğŸ’°ğŸ’°ğŸ’°ğŸ’°\n`;
            if (winners.length > 0) {
                winners.forEach(p => { text += `${p.name} +${p.result}\n`; });
            } else {
                text += `(ç„¡)\n`;
            }

            text += `\nğŸ©¸ğŸ©¸ğŸ©¸ğŸ©¸\n`;
            if (losers.length > 0) {
                losers.forEach(p => { text += `${p.name} ${p.result}\n`; });
            } else {
                text += `(ç„¡)\n`;
            }

            const textArea = document.getElementById('exportText');
            textArea.value = text;
            document.getElementById('exportModal').style.display = 'flex';
        }

        function closeExportModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('exportModal').style.display = 'none';
        }

        function copyToClipboard() {
            const textArea = document.getElementById('exportText');
            textArea.select();
            textArea.setSelectionRange(0, 99999);
            try {
                navigator.clipboard.writeText(textArea.value).then(() => {
                    alert("âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
                }).catch(() => {
                    document.execCommand('copy');
                    alert("âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
                });
            } catch (err) {
                alert("âŒ è¤‡è£½å¤±æ•—");
            }
        }

        // --- 5. é‡ç½®é‚è¼¯ ---
        function openResetModal() {
            document.getElementById('resetModal').style.display = 'flex';
        }

        function closeResetModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('resetModal').style.display = 'none';
        }

        function executeReset() {
            // ç´€éŒ„æ­·å²
            recordHistory();

            players = [];
            saveToStorage();
            renderPlayerList();
            document.getElementById('resetModal').style.display = 'none';
        }

        // --- æ¸²æŸ“èˆ‡è¨ˆç®—æ ¸å¿ƒ ---
        function renderPlayerList() {
            const listEl = document.getElementById('playerList');
            const countEl = document.getElementById('playerCount');
            const totalBuyInEl = document.getElementById('totalBuyIn');
            const totalCashOutEl = document.getElementById('totalCashOut');
            const statusEl = document.getElementById('balanceStatus');

            let totalBuyIn = 0;
            let totalCashOut = 0;
            players.forEach(p => {
                totalBuyIn += p.buyIn;
                totalCashOut += p.cashOut;
            });

            countEl.textContent = players.length;
            totalBuyInEl.textContent = totalBuyIn;
            totalCashOutEl.textContent = totalCashOut;

            const diff = totalCashOut - totalBuyIn;
            if (players.length === 0) {
                listEl.innerHTML = '<div class="empty-state">å°šæœªåŠ å…¥ç©å®¶<br>é»æ“Šå³ä¸Šè§’æ–°å¢</div>';
                statusEl.innerHTML = 'ç­‰å¾…é–‹å§‹...';
                statusEl.style.color = '#777';
            } else {
                if (diff === 0) {
                    statusEl.innerHTML = 'âœ… å¸³ç›®å¹³è¡¡ (å®Œç¾)';
                    statusEl.style.color = 'var(--green)';
                } else {
                    statusEl.innerHTML = `âŒ å¸³ç›®ä¸ç¬¦ (å·®é¡: ${diff})`;
                    statusEl.style.color = 'var(--red)';
                }
                
                let html = '';
                players.forEach(p => {
                    const result = p.cashOut - p.buyIn;
                    const resultClass = result > 0 ? 'win' : (result < 0 ? 'lose' : '');
                    const resultText = result > 0 ? `+${result}` : result;

                    html += `
                    <div class="player-card">
                        <div class="card-header">
                            <div class="p-name">${p.name} <span style="font-size:0.8rem; color:#666; font-weight:normal">Result:</span> <span class="${resultClass}">${resultText}</span></div>
                            <button class="btn-del" onclick="openDeleteModal(${p.id})">âœ•</button>
                        </div>
                        
                        <div class="input-group">
                            <span class="label">ç¸½è²·å…¥ Buy-in</span>
                            <input type="number" value="${p.buyIn}" onchange="requestUpdate(${p.id}, 'buyIn', this)">
                        </div>
                        
                        <div class="input-group input-cashout">
                            <span class="label">çµç®— Cash Out</span>
                            <input type="number" value="${p.cashOut}" onchange="requestUpdate(${p.id}, 'cashOut', this)" placeholder="0">
                        </div>
                    </div>
                    `;
                });
                listEl.innerHTML = html;
            }
        }

        // Enter éµæ”¯æ´
        document.getElementById('modalBuyIn').addEventListener('keypress', function(e){
            if(e.key === 'Enter') confirmAddPlayer();
        });
        document.getElementById('modalName').addEventListener('keypress', function(e){
            if(e.key === 'Enter') document.getElementById('modalBuyIn').focus();
        });

        // --- å•Ÿå‹•æ™‚è®€å–è³‡æ–™ ---
        loadFromStorage();

    </script>
</body>
</html>
